#! /bin/zsh

if [ ! -t 0 ] ; then
    return 0
fi

syst=$(uname -s | tr '[:upper:]' '[:lower:]')
if [ "$syst" = 'linux' ] ; then
    if   grep -E -i 'ubuntu|debian'      /etc/os-release >/dev/null 2>&1 ; then
        syst=debian-linux
    elif grep -E -i 'centos|rhel|fedora' /etc/os-release >/dev/null 2>&1 ; then
        syst=redhat-linux
    else
        syst=unknown-linux
    fi
fi

case $syst in
darwin)
    if [[ $(( $(/usr/bin/stat -Lf %m "$0") + 2 * 24 * 60 * 60 )) -lt $(date +%s) ]] ; then
        /usr/sbin/softwareupdate -l
        brew update >/dev/null 2>&-
        brew outdated
    fi
    ;;
debian-linux)
    if [[ $(( $(stat --format %Y  "$0") + 2 * 24 * 60 * 60 )) -lt $(date +%s) ]] ; then
        /usr/lib/update-notifier/apt-check -p
    fi
    ;;
centos-linux)
    if [[ $(( $(stat --format %Y  "$0") + 2 * 24 * 60 * 60 )) -lt $(date +%s) ]] ; then
        yum list upgradable
    fi
    ;;
*)
    print "$(basename "$0"): unknown system $syst, updates check not done\n" >&2
    ;;
esac
touch -m "$0"
