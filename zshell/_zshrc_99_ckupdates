#! /bin/zsh

if [ ! -t 0 ] ; then
    return 0
fi

TWODAYS=$(( 2 * 24 * 60 * 60 ))
if /usr/bin/stat --format %Y "$0" >/dev/null 2>&-
then
    # Linux
    test $(( $(/usr/bin/stat --format %Y  "$0") + TWODAYS ))	\
       -lt "$(date +%s)" || return 0
else
    # Darwin
    test $(( $(/usr/bin/stat -Lf %m "$0")       + TWODAYS ))	\
       -lt "$(date +%s)" || return 0
fi

case "$(uname -rv | tr '[:upper:]' '[:lower:]')" in
    *darwin*)
        /usr/sbin/softwareupdate -l
        brew update >/dev/null 2>&-
        brew outdated
	;;
    *ubuntu*|*debian*)
        /usr/lib/update-notifier/apt-check -p
	;;
    *centos*|*rhel*|*fedora*)
	yum list upgradable
	;;
    *arch*)
        export AURDEST=/var/pacman/packages
        export AUR_PACMAN_AUTH="sudo --askpass"
        export AUR_PAGER=ranger
        export AUR_REPO=AUR

        paclist AUR | aur vercmp
        checkupdates
        ;;
    *)
	printf "%s: unknown system %s (%s), updates check not done.\n"	\
               "$(basename "$0")" "$(uname -s)" "$(uname -r)"
	;;
esac
touch -m "$0"
